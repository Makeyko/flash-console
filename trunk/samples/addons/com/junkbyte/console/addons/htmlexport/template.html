<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Console log</title>
<style type="text/css">
body,td,th{
	font-family: Verdana, Geneva, sans-serif;
	font-size: 12px;
}
a {
	font-style:inherit;
	color:inherit;
	text-decoration:none;
}
body {
	background-color: #REPLACE_BG_FROM_FLASH;
}
menu{
	padding-left:0;
}
log{
	display:inline;
}
#menuElement{
    position: fixed;
    overflow: hidden;
}
#logsElement{
    position: fixed;
    top: 26px;
    left: 5pt;
    bottom: 5px;
    right: 5pt;
    overflow: auto;
}
#REPLACE_STYLES_FROM_FLASH{}
</style>

<script type="text/javascript">
	var logs = [{text:'REPLACE_LOGS_FROM_FLASH'}];
</script>
<script type="text/javascript">
	
	var channels = new Object();
	var priorities = new Object();
	var viewingPriority = 0;
	var viewingChannels = null;
	
	var shiftKeyPressed = false;
	var ctrlKeyPressed = false;
	
	document.onkeydown=updateKeyAccessors;
	document.onkeyup=updateKeyAccessors;
	
	
	function updateKeyAccessors(e)
	{
		shiftKeyPressed = e.shiftKey;
		ctrlKeyPressed = e.ctrlKey;
	}
	
	function init()
	{
		
		var len = logs.length;
		for (var i = 0; i<len; i++)
		{
			var log = logs[i];
			channels[log.ch] = true;
			priorities[log.priority] = true;
		}
		
		updateMenu();
		writeLogs();
	}
	
	function updateMenu()
	{
		var text = "<high><menu><b>";
		text += makeJSLink("P"+viewingPriority, "increaseViewingPriority()") + " </b></menu> | ";
		var chText = makeJSLink(" * ", "channelClicked(null)" );
		if(!viewingChannels)
		{
			chText = "<ch>"+chText+"</ch>"; 
		}
		text += "<chs> ["+chText +"] ";
		for (var ch in channels)
		{
			var chText = makeJSLink(ch, "channelClicked(\""+ch+"\")" ) ;
			if(viewingChannels && viewingChannels[ch])
			{
				chText = "<ch>"+chText+"</ch>"; 
			}
			text += "["+chText+ "] ";
		}
		text += "</chs></high>"
		document.getElementById("menuElement").innerHTML = text;
	}
	
	function increaseViewingPriority()
	{
		viewingPriority ++;
		while(!priorities[viewingPriority])
		{
			viewingPriority ++;
			if(viewingPriority > 10)
			{
				viewingPriority = 0;
				break;
			}
		}
		updateMenu();
		writeLogs();
	}
	
	function channelClicked(channel)
	{
		if(shiftKeyPressed)
		{
			viewingChannels[channel] = true;
		}
		else if(channel)
		{
			viewingChannels = new Object();
			viewingChannels[channel] = true;
		}
		else
		{
			 viewingChannels = null;
		}
		updateMenu();
		writeLogs();
	}
	
	function writeLogs() {
		var text = "";
		var len = logs.length;
		for (var i = 0; i<len; i++)
		{
			var log = logs[i];
			if(shouldShow(log))
			{
				text += makeLine(log);
			}
		}
		document.getElementById("logsElement").innerHTML = text;
	}
	
	function shouldShow(log)
	{
		if(!viewingChannels || viewingChannels[log.ch])
		{
			if(viewingPriority == 0 || log.priority >= viewingPriority)
			{
				return true;
			}
		}
		return false;
	}
	
	function makeLine(log)
	{
		var txt = "[" + makeJSLink(log.ch, "channelClicked(\""+log.ch+"\")" ) + "] " + log.text;
		var ptag = "p"+log.priority;
		txt = "<log><"+ptag+">" + txt + "</"+ptag+"></log>";
		return txt + "<br/>";
	}
	
	function makeJSLink(text, linkFunction)
	{
		return "<a href='javascript:"+linkFunction+";'>"+text+"</a>";
	}
</script>
</head>
<body onload="init()">
    <div id="menuElement"><strong> P0 </strong> [ * ] [-] [C] [html]</div>
    <div id="logsElement"></div>
</body>
</html>